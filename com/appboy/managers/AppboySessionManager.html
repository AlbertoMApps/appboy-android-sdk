<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--NewPage-->
<HTML>
<HEAD>
<!-- Generated by javadoc (build 1.6.0_37) on Thu Feb 21 17:19:32 EST 2013 -->
<TITLE>
AppboySessionManager (android-sdk-base 0.0 API)
</TITLE>

<META NAME="date" CONTENT="2013-02-21">

<LINK REL ="stylesheet" TYPE="text/css" HREF="../../../stylesheet.css" TITLE="Style">

<SCRIPT type="text/javascript">
function windowTitle()
{
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="AppboySessionManager (android-sdk-base 0.0 API)";
    }
}
</SCRIPT>
<NOSCRIPT>
</NOSCRIPT>

</HEAD>

<BODY BGCOLOR="white" onload="windowTitle();">
<HR>


<!-- ========= START OF TOP NAVBAR ======= -->
<A NAME="navbar_top"><!-- --></A>
<A HREF="#skip-navbar_top" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../com/appboy/managers/AppboyManager.html" title="class in com.appboy.managers"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../com/appboy/managers/IDeviceIdReader.html" title="interface in com.appboy.managers"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../index.html?com/appboy/managers/AppboySessionManager.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="AppboySessionManager.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_top"></A>
<!-- ========= END OF TOP NAVBAR ========= -->

<HR>
<!-- ======== START OF CLASS DATA ======== -->
<H2>
<FONT SIZE="-1">
com.appboy.managers</FONT>
<BR>
Class AppboySessionManager</H2>
<PRE>
java.lang.Object
  <IMG SRC="../../../resources/inherit.gif" ALT="extended by "><B>com.appboy.managers.AppboySessionManager</B>
</PRE>
<HR>
<DL>
<DT><PRE>public final class <B>AppboySessionManager</B><DT>extends java.lang.Object</DL>
</PRE>

<P>
Manages the current active session and allows for the open/closing/modifying of it.

 Following other analytics providers, we suggest that startSession is invoked in onStart() and that stopSession
 is invoked in onStop(). Calling startSession repeatedly without calling stopSession will not result in new
 sessions being opened, however, calling stopSession or getCurrentSessionId will open a new session if one is
 not already active.

 Effort has been made to make this class thread-safe. Thread safety is accomplished with a lock per instance
 that serializes all changes to the current session reference as well as any mutations to the current session.
 Mutations must be protected so that another call can't seal up the session before (for instance) an in-flight
 call to add a new custom event completes.

 All updates to the mutable session tracked by this manager will be persisted to offline storage with the
 injected offline storage manager. Calls to the offline storage manager are made with the lock per instance, so
 the injected manager should do work to make sure it isn't doing anything bad like blocking on I/O before
 returning.

 This manager uses a concept of sealed sessions to finalize the custom events and end time for the current active
 session being tracked. Events are only included on session objects once the session is completely over, or
 "sealed". This allows us to deliver the same session object to the server more than once (taking into
 account internet connectivity, etc. problems) without worrying about the server double-counting sessions.
 With this client behavior, the server side can know that any session object with a non-null end time has a
 complete events list. If it receives a session with the same id in the future, it knows that the session was
 already recorded and ignores it.

 One complication with session tracking in Android is that switching between multiple
 activities within an application shouldn't necessarily start a new session each time. If this manager is
 configured to allow stopped sessions to be continued, calls made to start/stop sessions will re-open the
 previously stopped session if it was stopped during the grace period. This behavior is consistent with Flurry's
 start and stop session.

 The manager does nothing to actively flush its contents, however it exposes the ability to retrieve an
 IntermediateSession object representing the current state of the session being tracked. Upon being sealed here,
 a SessionSealedEvent will be published by the MutableSession itself.
<P>

<P>
<HR>

<P>

<!-- ======== CONSTRUCTOR SUMMARY ======== -->

<A NAME="constructor_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Constructor Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><B><A HREF="../../../com/appboy/managers/AppboySessionManager.html#AppboySessionManager(com.appboy.managers.ILocationManager, com.appboy.managers.ISessionStorageManager, com.appboy.events.EventManager, com.appboy.events.IEventPublisher)">AppboySessionManager</A></B>(<A HREF="../../../com/appboy/managers/ILocationManager.html" title="interface in com.appboy.managers">ILocationManager</A>&nbsp;locationManager,
                     <A HREF="../../../com/appboy/managers/ISessionStorageManager.html" title="interface in com.appboy.managers">ISessionStorageManager</A>&nbsp;sessionStorageManager,
                     <A HREF="../../../com/appboy/events/EventManager.html" title="class in com.appboy.events">EventManager</A>&nbsp;eventManager,
                     <A HREF="../../../com/appboy/events/IEventPublisher.html" title="interface in com.appboy.events">IEventPublisher</A>&nbsp;eventPublisher)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The session manager will "re-open" otherwise
   closed sessions if the call to StartSession comes within the interval defined by
   AppboySessionManager.DEFAULT_CONTINUE_SESSION_PERIOD_MS.</TD>
</TR>
</TABLE>
&nbsp;
<!-- ========== METHOD SUMMARY =========== -->

<A NAME="method_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Method Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;boolean</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../com/appboy/managers/AppboySessionManager.html#addSessionEvent(com.appboy.models.IAppboyEvent)">addSessionEvent</A></B>(<A HREF="../../../com/appboy/models/IAppboyEvent.html" title="interface in com.appboy.models">IAppboyEvent</A>&nbsp;event)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Used to add an IAppboyEvent to the active session.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<A HREF="../../../com/appboy/models/SessionId.html" title="class in com.appboy.models">SessionId</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../com/appboy/managers/AppboySessionManager.html#getCurrentSessionId()">getCurrentSessionId</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<A HREF="../../../com/appboy/models/outgoing/IntermediateSession.html" title="class in com.appboy.models.outgoing">IntermediateSession</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../com/appboy/managers/AppboySessionManager.html#startSession()">startSession</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Creates a new session, continues the current session (if open), or reopens recently closed session
 (if configured to continue sessions and the last session end was within the grace period).</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../com/appboy/managers/AppboySessionManager.html#stopSession()">stopSession</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Puts an end time on the current session, creating one if none exists (and then immediately adding an end time).</TD>
</TR>
</TABLE>
&nbsp;<A NAME="methods_inherited_from_class_java.lang.Object"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
<TH ALIGN="left"><B>Methods inherited from class java.lang.Object</B></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</CODE></TD>
</TR>
</TABLE>
&nbsp;
<P>

<!-- ========= CONSTRUCTOR DETAIL ======== -->

<A NAME="constructor_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Constructor Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="AppboySessionManager(com.appboy.managers.ILocationManager, com.appboy.managers.ISessionStorageManager, com.appboy.events.EventManager, com.appboy.events.IEventPublisher)"><!-- --></A><H3>
AppboySessionManager</H3>
<PRE>
public <B>AppboySessionManager</B>(<A HREF="../../../com/appboy/managers/ILocationManager.html" title="interface in com.appboy.managers">ILocationManager</A>&nbsp;locationManager,
                            <A HREF="../../../com/appboy/managers/ISessionStorageManager.html" title="interface in com.appboy.managers">ISessionStorageManager</A>&nbsp;sessionStorageManager,
                            <A HREF="../../../com/appboy/events/EventManager.html" title="class in com.appboy.events">EventManager</A>&nbsp;eventManager,
                            <A HREF="../../../com/appboy/events/IEventPublisher.html" title="interface in com.appboy.events">IEventPublisher</A>&nbsp;eventPublisher)</PRE>
<DL>
<DD>The session manager will "re-open" otherwise
   closed sessions if the call to StartSession comes within the interval defined by
   AppboySessionManager.DEFAULT_CONTINUE_SESSION_PERIOD_MS. The need for a scheme like this stems from the fact
   that Android apps can be entered in a variety of ways, activities can be left for intents like saving, etc.
   This particular implementation was chosen in order to be consistent with existing analytics
   solutions for Android.
<P>
</DL>

<!-- ============ METHOD DETAIL ========== -->

<A NAME="method_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Method Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="startSession()"><!-- --></A><H3>
startSession</H3>
<PRE>
public <A HREF="../../../com/appboy/models/outgoing/IntermediateSession.html" title="class in com.appboy.models.outgoing">IntermediateSession</A> <B>startSession</B>()</PRE>
<DL>
<DD>Creates a new session, continues the current session (if open), or reopens recently closed session
 (if configured to continue sessions and the last session end was within the grace period).

 If a new session is opened and an old one was being managed, the old session will be sealed.
<P>
<DD><DL>

<DT><B>Returns:</B><DD>the currently open IntermediateSession being tracked.</DL>
</DD>
</DL>
<HR>

<A NAME="stopSession()"><!-- --></A><H3>
stopSession</H3>
<PRE>
public void <B>stopSession</B>()</PRE>
<DL>
<DD>Puts an end time on the current session, creating one if none exists (and then immediately adding an end time).

 If sessions cannot be continued, this immediately seals the session, but
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="addSessionEvent(com.appboy.models.IAppboyEvent)"><!-- --></A><H3>
addSessionEvent</H3>
<PRE>
public boolean <B>addSessionEvent</B>(<A HREF="../../../com/appboy/models/IAppboyEvent.html" title="interface in com.appboy.models">IAppboyEvent</A>&nbsp;event)</PRE>
<DL>
<DD>Used to add an IAppboyEvent to the active session. If invoked without an active session, the event is ignored.
 This is done to keep background code not in the context of an explicitly opened session from generating a bunch
 of spurious sessions while the app isn't being explicitly used.
<P>
<DD><DL>

<DT><B>Returns:</B><DD>Whether or not an event was actually added.</DL>
</DD>
</DL>
<HR>

<A NAME="getCurrentSessionId()"><!-- --></A><H3>
getCurrentSessionId</H3>
<PRE>
public <A HREF="../../../com/appboy/models/SessionId.html" title="class in com.appboy.models">SessionId</A> <B>getCurrentSessionId</B>()</PRE>
<DL>
<DD><DL>

<DT><B>Returns:</B><DD>the session ID of the active session (if it isn't and shouldn't be sealed). Otherwise, null.</DL>
</DD>
</DL>
<!-- ========= END OF CLASS DATA ========= -->
<HR>


<!-- ======= START OF BOTTOM NAVBAR ====== -->
<A NAME="navbar_bottom"><!-- --></A>
<A HREF="#skip-navbar_bottom" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_bottom_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../com/appboy/managers/AppboyManager.html" title="class in com.appboy.managers"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../com/appboy/managers/IDeviceIdReader.html" title="interface in com.appboy.managers"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../index.html?com/appboy/managers/AppboySessionManager.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="AppboySessionManager.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_bottom"></A>
<!-- ======== END OF BOTTOM NAVBAR ======= -->

<HR>

</BODY>
</HTML>
